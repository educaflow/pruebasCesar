<?xml version="1.0"?>

<auth>
  <permissions>

    <permission name="tramite.lectura"
                object="com.educaflow.apps.expedientes.db.Tramite"
                condition="
EXISTS (
  SELECT 1 FROM com.educaflow.apps.seguridad.db.Permiso p
  WHERE p.tramite = self
  AND p.perfil = 'CREADOR'
  AND EXISTS (
    SELECT 1 FROM com.educaflow.apps.sistemaeducativo.db.CentroUsuario cu
    WHERE cu.usuario = ?
    AND cu.tipoUsuario = p.tipoUsuario
    AND cu.centro.code = '46019660'
    AND (
      p.cargo IS NULL
      OR EXISTS (
        SELECT 1 FROM cu.cargos c
        WHERE c = p.cargo
      )
    )
  )
)
"
                conditionParams="__user__">
      <can read="true" create="false" write="false" import="false" export="false" remove="false"/>
    </permission>

    <permission name="expendiente.lecturaAdministrador"
                object="com.educaflow.apps.expedientes.db.Expediente"
                condition="
EXISTS (
  SELECT 1
  FROM com.educaflow.apps.sistemaeducativo.db.CentroUsuario cu
  WHERE cu.usuario = ?
    AND cu.centro.code = '46019660'
    AND EXISTS (
      SELECT 1
      FROM cu.cargos cargo
      WHERE cargo.code = 'admin'
    )
)
"
                conditionParams="__user__"
>
        <can read="true" create="false" write="true" import="false" export="false" remove="false"/>
    </permission>
    <permission name="expediente.lecturaCreador"
                object="com.educaflow.apps.expedientes.db.Expediente"
                condition="
                self.createdBy = ?
"
                conditionParams="__user__">
      <can read="true" create="false" write="true" import="false" export="false" remove="false"/>
    </permission>

    <!--<permission name="expediente.lectura"
                object="com.educaflow.apps.expedientes.db.Expediente"
                condition="
EXISTS (
  SELECT 1 FROM com.educaflow.apps.seguridad.db.Permiso p
  WHERE p.tramite = self.tipoExpediente.tramite
  AND EXISTS (
    SELECT 1 FROM com.educaflow.apps.sistemaeducativo.db.CentroUsuario cu
    WHERE cu.usuario = ?
    AND cu.tipoUsuario = p.tipoUsuario
    AND (
      p.cargo IS NULL
      OR EXISTS (
        SELECT 1 FROM cu.cargos c
        WHERE c = p.cargo
      )
    )
  )
)"
                conditionParams="__user__">
      <can read="true" create="false" write="false" import="false" export="false" remove="false"/>
    </permission>-->
    <!--<permission name="expediente.escritura" object="com.educaflow.apps.expedientes.db.Expediente"
                condition="
EXISTS (
  SELECT 1 FROM com.educaflow.apps.seguridad.db.Permiso p
  WHERE p.tramite = self.tipoExpediente.tramite
  AND p.perfil = 'CREADOR'
  AND EXISTS (
    SELECT 1 FROM com.educaflow.apps.sistemaeducativo.db.CentroUsuario cu
    WHERE cu.usuario = ?
    AND cu.tipoUsuario = p.tipoUsuario
    AND (
      p.cargo IS NULL
      OR EXISTS (
        SELECT 1 FROM cu.cargos c
        WHERE c = p.cargo
      )
    )
  )
)"
                conditionParams="__user__">
      <can read="true" create="false" write="true" import="false" export="false" remove="false"/>
    </permission>-->
  </permissions>

  <group code="users">
    <permissions>
      <permission name="tramite.lectura"/>
      <permission name="expendiente.lecturaAdministrador"/>
      <permission name="expediente.lecturaCreador"/>
      <!--<permission name="expediente.lectura"/>-->
      <!--<permission name="expediente.escritura"/>-->
    </permissions>
  </group>


</auth>
