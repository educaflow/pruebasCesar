<?xml version="1.0"?>

<auth>
  <permissions>
      <!--<permission name="tramite.all"
                object="com.educaflow.apps.expedientes.db.Tramite"
                condition="
EXISTS (SELECT 1 FROM com.educaflow.apps.seguridad.db.Permiso p
WHERE p.centro = ? AND p.tramite = self AND p.perfil = 'CREADOR' AND ? IN (SELECT cu.usuario
FROM com.educaflow.apps.sistemaeducativo.db.CentroUsuario cu WHERE cu.centro = p.centro AND cu.tipoUsuario = p.tipoUsuario
AND (NOT EXISTS(SELECT 1 FROM com.educaflow.apps.sistemaeducativo.db.Cargo c WHERE c = p.cargo)
OR p.cargo MEMBER OF cu.cargos)))
"
                conditionParams="__user__.centroActivo, __user__">
          <can read="true" create="false" write="false" import="false" export="false" remove="false"/>
      </permission>-->

      <permission name="tramite.all"
                  object="com.educaflow.apps.expedientes.db.Tramite"
                  condition="
EXISTS (SELECT 1 FROM com.educaflow.apps.seguridad.db.Permiso p
WHERE p.centro = ? AND p.tramite = self AND p.perfil = 'CREADOR' AND ? IN (SELECT cu.usuario
FROM com.educaflow.apps.sistemaeducativo.db.CentroUsuario cu WHERE cu.centro = p.centro AND cu.tipoUsuario = p.tipoUsuario
AND (p.cargo IS NULL OR p.cargo MEMBER OF cu.cargos)))
"
                  conditionParams="__user__.centroActivo, __user__">
          <can read="true" create="false" write="false" import="false" export="false" remove="false"/>
      </permission>

<!--      <permission name="tipoTramite.all"
                  object="com.educaflow.apps.expedientes.db.TipoTramite"
                  condition="
EXISTS (SELECT 1 FROM com.educaflow.apps.expedientes.db.Tramite t WHERE self=t.tipoTramite
AND EXISTS(SELECT 1 FROM com.educaflow.apps.seguridad.db.Permiso p WHERE p.tramite = t AND p.centro = ?  AND p.perfil = 'CREADOR' AND ? IN (
SELECT cu.usuario FROM com.educaflow.apps.sistemaeducativo.db.CentroUsuario cu WHERE cu.centro = p.centro
AND cu.tipoUsuario = p.tipoUsuario AND (NOT EXISTS(SELECT 1 FROM com.educaflow.apps.sistemaeducativo.db.Cargo c WHERE c = p.cargo)
OR p.cargo MEMBER OF cu.cargos))))
"
                  conditionParams="__user__.centroActivo, __user__">
          <can read="true" create="true" write="true" import="true" export="true" remove="true"/>
      </permission>-->

      <permission name="tipoTramite.all"
                  object="com.educaflow.apps.expedientes.db.TipoTramite"
                  condition="
EXISTS (SELECT 1 FROM com.educaflow.apps.expedientes.db.Tramite t WHERE self=t.tipoTramite
AND EXISTS(SELECT 1 FROM com.educaflow.apps.seguridad.db.Permiso p WHERE p.tramite = t AND p.centro = ?  AND p.perfil = 'CREADOR' AND ? IN (
SELECT cu.usuario FROM com.educaflow.apps.sistemaeducativo.db.CentroUsuario cu WHERE cu.centro = p.centro
AND cu.tipoUsuario = p.tipoUsuario AND (p.cargo IS NULL OR p.cargo MEMBER OF cu.cargos))))
"
                  conditionParams="__user__.centroActivo, __user__">
          <can read="true" create="true" write="true" import="true" export="true" remove="true"/>
      </permission>


      <permission name="centros.all"
                  object="com.educaflow.apps.sistemaeducativo.db.Centro"
                  condition="
                        EXISTS (
                            SELECT 1
                            FROM com.educaflow.apps.sistemaeducativo.db.CentroUsuario cu
                            WHERE cu.usuario = ? AND cu.centro = self
                        )
                    "
                  conditionParams="__user__">
        <can read="true" create="false" write="false" import="false" export="false" remove="false"/>
      </permission>

      <permission name="user.read"
                  object="com.axelor.auth.db.User"
                  condition="
                        EXISTS (
                            SELECT 1
                            FROM com.educaflow.apps.sistemaeducativo.db.CentroUsuario cu
                            WHERE cu.centro = ? AND cu.usuario = self
                        )
                    "
                  conditionParams="__user__.centroActivo">
          <can read="true" create="false" write="false" import="false" export="false" remove="false"/>
      </permission>

      <permission name="user.write"
                    object="com.axelor.auth.db.User"
                    condition="
                      self = ?
                    "
                    conditionParams="__user__">
            <can read="true" create="false" write="true" import="false" export="false" remove="false"/>
      </permission>

      <permission name="ciclos.all" object="com.educaflow.apps.sistemaeducativo.db.Ciclo"
                  condition="
                      EXISTS (
                            SELECT 1
                            FROM com.educaflow.apps.sistemaeducativo.db.Centro c
                            WHERE c = ? AND self MEMBER OF c.ciclos
                      )
                  "
                  conditionParams="__user__.centroActivo">
          <can read="true" create="false" write="false" import="false" export="false" remove="false"/>
      </permission>

      <permission name="grupos.all" object="com.educaflow.apps.sistemaeducativo.db.Grupo"
                  condition="
                        EXISTS (
                            SELECT 1
                            FROM com.educaflow.apps.sistemaeducativo.db.CentroCurso cc
                            WHERE cc.centro = ? AND self MEMBER OF cc.grupos
                        )
                    "
                  conditionParams="__user__.centroActivo">
          <can read="true" create="false" write="false" import="false" export="false" remove="false"/>
      </permission>
      <permission name="cursos.all" object="com.educaflow.apps.sistemaeducativo.db.Curso"
                  condition="
                        EXISTS (
                            SELECT 1
                            FROM com.educaflow.apps.sistemaeducativo.db.CentroCurso cc
                            WHERE cc.centro = ? AND cc.curso = self
                        )
                    "
                  conditionParams="__user__.centroActivo">
          <can read="true" create="false" write="false" import="false" export="false" remove="false"/>
      </permission>
      <permission name="valoresAmbito.all" object="com.educaflow.apps.expedientes.db.ValoresAmbito">
          <can read="true" create="true" write="true" import="true" export="true" remove="true"/>
      </permission>
      <permission name="departamento.all" object="com.educaflow.apps.sistemaeducativo.db.Departamento"
                    condition="
                        EXISTS (
                            SELECT 1
                            FROM com.educaflow.apps.sistemaeducativo.db.CentroUsuario cu
                            WHERE cu.centro = ? AND self MEMBER OF cu.departamentos
                        )
                    "
                    conditionParams="__user__.centroActivo">
          <can create="false" read="true" write="false" remove="false" export="false"/>
      </permission>
      <permission name="cargos.all" object="com.educaflow.apps.sistemaeducativo.db.Cargo"
                    condition="
                        EXISTS (
                            SELECT 1
                            FROM com.educaflow.apps.sistemaeducativo.db.Centro c
                            WHERE c = ? AND self MEMBER OF c.cargos
                        )
                    "
                    conditionParams="__user__.centroActivo">
          <can create="false" read="true" write="false" remove="false" export="false"/>
      </permission>
      <permission name="modulos.all" object="com.educaflow.apps.sistemaeducativo.db.Modulo"
                    condition="
                        EXISTS (
                            SELECT 1
                            FROM com.educaflow.apps.sistemaeducativo.db.Centro c
                            WHERE c = ?
                              AND EXISTS (
                                SELECT 1
                                FROM com.educaflow.apps.sistemaeducativo.db.Curso co
                                WHERE co MEMBER OF (
                                    SELECT ci.cursos
                                    FROM com.educaflow.apps.sistemaeducativo.db.Ciclo ci
                                    WHERE ci MEMBER OF c.ciclos
                                )
                                AND self MEMBER OF co.modulos
                              )
                        )
                    "
                    conditionParams="__user__.centroActivo">
          <can read="true" create="false" write="false" import="false" export="false" remove="false"/>
      </permission>
<!--      <permission name="expedientes.all" object="com.educaflow.apps.expedientes.db.Expediente">
          <can read="true" create="false" write="true" import="false" export="false" remove="false"/>
      </permission>
      <permission name="firmarActas.all" object="com.educaflow.apps.expedientes.db.FirmarActas">
          <can read="true" create="false" write="true" import="false" export="false" remove="false"/>
      </permission>-->
  </permissions>

  <group code="users">
    <permissions>
        <permission name="tramite.all"/>
        <permission name="tipoTramite.all"/>
        <permission name="centros.all"/>
        <permission name="user.read"/>
        <permission name="user.write"/>
        <permission name="ciclos.all"/>
        <permission name="grupos.all"/>
        <permission name="cursos.all"/>
        <permission name="valoresAmbito.all"/>
        <permission name="departamento.all"/>
        <permission name="cargos.all"/>
        <permission name="modulos.all"/>
        <!--<permission name="expedientes.all"/>
        <permission name="firmarActas.all"/>-->
    </permissions>
  </group>


</auth>
