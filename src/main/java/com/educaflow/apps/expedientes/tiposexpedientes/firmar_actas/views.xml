<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xmlns="http://axelor.com/xml/ns/object-views"
              xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.1.xsd">


    <action-record name="change-ciclo-action" model="com.educaflow.apps.expedientes.db.FirmarActas">
        <field name="curso" expr="eval: null"/>
        <field name="grupo" expr="eval: null"/>
        <!--<field name="valoresAmbitoResponsable.ciclo" expr="ciclo"/>-->
    </action-record>

    <action-record name="change-curso-action" model="com.educaflow.apps.expedientes.db.FirmarActas">
        <field name="grupo" expr="eval: null"/>
        <!--field name="valoresAmbitoResponsable.curso" expr="curso"/>-->
    </action-record>



    <form name="exp-FirmarActas-Templates" title="Firmar Actas"  width="large"  model="com.educaflow.apps.expedientes.db.FirmarActas" groups="admins,users">
        <panel name="ambito-responsable" title="Ámbito del Responsable">
            <field name="numeroExpediente"
                   colSpan="6"
            />
            <field name="valoresAmbitoCreador.centro"
                   colSpan="6"
            />
            <field name="ciclo"
                   colSpan="4"
                   onChange="change-ciclo-action"
                   grid-view="buscar-ciclos"
                   form-view="Ciclo"
            />
            <field name="curso"
                   colSpan="4"
                   onChange="change-curso-action"
                   domain="
                       EXISTS (
                           SELECT 1
                           FROM com.educaflow.apps.sistemaeducativo.db.Ciclo c
                           WHERE c = :ciclo
                           AND self MEMBER OF c.cursos
                       )
                   "
            />
            <field name="grupo"
                   colSpan="4"
                   domain="
                       EXISTS (
                           SELECT 1
                           FROM com.educaflow.apps.sistemaeducativo.db.CentroCurso cc
                           WHERE cc.curso = :curso
                           AND self MEMBER OF cc.grupos
                       )
                   "
            />
            <!--<field name="grupo"
                   colSpan="4"
                   domain="self IN (SELECT cc.grupos FROM com.educaflow.apps.sistemaeducativo.db.CentroCurso cc
                       WHERE cc.curso = :curso AND cc.centro = ?)"
                   domainParams="__user__.centroActivo"
            />-->
        </panel>
        <panel name="acta" title="Acta">
            <field name="acta"
                   colSpan="6"
                   widget="binary-link"
            />
            <field name="actaFirmada"
                   colSpan="6"
                   widget="binary-link"
            />
        </panel>
    </form>

    <grid name="buscar-ciclos" title="Ciclos" model="com.educaflow.apps.sistemaeducativo.db.Ciclo"
          groups="admins,users"
          editable="false" edit-icon="false" x-selector="none" canNew="false" canEdit="false" canDelete="false" canSave="false"
    >
        <field name="code" width="200px" />
        <field name="name"/>
    </grid>

    <form name="Ciclo"  title="Ciclo" width="large" model="com.educaflow.apps.sistemaeducativo.db.Ciclo" groups="admins,users">
        <panel name="Ciclo" title="Ciclo">
            <field name="name"/>
        </panel>
    </form>

    <grid name="buscar-curso" title="Curso" model="com.educaflow.apps.sistemaeducativo.db.Curso"
          groups="admins,users"
          editable="false" edit-icon="false" x-selector="none" canNew="false" canEdit="false" canDelete="false" canSave="false"
    >
        <field name="code" width="200px" />
        <field name="name"/>
    </grid>

    <form name="Curso"  title="Curso" width="large" model="com.educaflow.apps.sistemaeducativo.db.Curso" groups="admins,users">
        <panel name="Curso" title="Curso">
            <field name="name"/>
        </panel>
    </form>

    <grid name="buscar-grupo" title="Grupo" model="com.educaflow.apps.sistemaeducativo.db.Grupo"
          groups="admins,users"
          editable="false" edit-icon="false" x-selector="none" canNew="false" canEdit="false" canDelete="false" canSave="false"
    >
        <field name="code" width="200px" />
        <field name="name"/>
    </grid>

    <form name="Grupo"  title="Grupo" width="large" model="com.educaflow.apps.sistemaeducativo.db.Grupo" groups="admins,users">
        <panel name="Grupo" title="Grupo">
            <field name="name"/>
        </panel>
    </form>



    <!-- *********************************************************************************************  -->
    <!-- *************************************** ENTRADA_DATOS ***************************************  -->
    <!-- *********************************************************************************************  -->
    
    <form state="ENTRADA_DATOS" profile="CREADOR">
        <include-panels includeHeader="true">
            ambito-responsable
            acta
        </include-panels>
        <footer>
            <buttons-left>
            </buttons-left>
            <buttons-right>
                <button name="PRESENTAR" colSpan="2" title="Presentar" onClick="action-event-expediente" />
            </buttons-right>
        </footer>

    </form>

    <form state="ENTRADA_DATOS" >
        <include-panels includeHeader="true">
            -ambito-responsable
            -acta
        </include-panels>
        <footer>
            <buttons-left>
            </buttons-left>
            <buttons-right>
                <!--<button name="" colSpan="2" title="" onClick="action-event-expediente" />-->
            </buttons-right>
        </footer>
    </form>



    <!-- **************************************************************************************************  -->
    <!-- *************************************** FIRMA_POR_USUARIOS ***************************************  -->
    <!-- **************************************************************************************************  -->
    
    <form state="FIRMA_POR_USUARIOS" profile="RESPONSABLE">
        <include-panels includeHeader="true">
            -ambito-responsable
            acta
        </include-panels>
        <footer>
            <buttons-left>
            </buttons-left>
            <buttons-right>
                <!--<button name="FIRMAR" colSpan="2" title="" onClick="action-event-expediente" />-->
            </buttons-right>
        </footer>

    </form>

    <form state="FIRMA_POR_USUARIOS" >
        <include-panels includeHeader="true">
            -ambito-responsable
            -acta
        </include-panels>
        <footer>
            <buttons-left>
            </buttons-left>
            <buttons-right>
                <button name="ACEPTAR" colSpan="2" title="Aceptar" onClick="action-event-expediente" />
            </buttons-right>
        </footer>
    </form>



    <!-- ****************************************************************************************  -->
    <!-- *************************************** ACEPTADO ***************************************  -->
    <!-- ****************************************************************************************  -->

    <form state="ACEPTADO" >
        <include-panels includeHeader="true">
            -ambito-responsable
            -acta
        </include-panels>
        <footer>
            <buttons-left>
            </buttons-left>
            <buttons-right>
                <button name="" colSpan="2" title="" onClick="action-event-expediente" />
            </buttons-right>
        </footer>
    </form>




</object-views>